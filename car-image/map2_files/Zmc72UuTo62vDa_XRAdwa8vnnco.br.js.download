var __spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},SmartPreview;(function(n){function r(n){for(var u,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];t&&t.config&&(u=t.config.ptnInstName||"",wt||Log&&Log.Log&&Log.Log.apply(Log,__spreadArray([n,v,u,!1],r,!1)))}function ft(n){r(y,vt,"Error",o,n)}function h(n){r(lt,o,n)}function et(n){n&&Log&&Log.LogFilterFlare&&Log.LogFilterFlare([n])}function d(n,i){var u=sb_st(function(){u=null;var n="",f="";t&&t.inst&&(n=t.inst.ns||"",f=t.inst.k||"");r(at,"HType",i,"AppNS",n,"K",f,"TS",sb_gt()+"")},n);return u}function bt(n){var i=n&&n.getAttribute("h"),t;if(i)return t=yt.exec(i),t&&t.length===3?{ns:t[1],k:t[2]}:void 0}function kt(t){var r,f;if(t){var u=t.hovTargetSel,i=t.hovTargetContSel,o=t.hovContId,h=t.mainImgSel;u&&i&&o&&h&&(r=_qs(i),!e[i]&&r&&(e[i]=t,r.setAttribute(a,i),f=_d.querySelectorAll(u),f.forEach(function(n){n.getAttribute(pt)||sj_be(n,nt,ot)})),typeof n.KapiService!="undefined"&&!s&&t.kapi&&(s=new n.KapiService(t.kapi)))}}function c(){var t,n,i;sj_ue(_w,tt,c);sj_evt.unbind(rt,c);l();for(t in e)n=e[t],n&&(i=_d.querySelectorAll(n.hovTargetSel),i.forEach(function(n){sj_ue(n,nt,ot)}))}function ot(n){var f,s,i,h,c,v;(l(),f=sj_et(n),f)&&(s=f.closest("[".concat(a,"]")),i=s&&e[s.getAttribute(a)],i)&&(h=_qs('[data-hcid="'.concat(i.hovContId,'"]')),c=dt(f,i),c&&h)&&(v=i.imgLinkSel&&_qs(i.imgLinkSel,f),t={el:f,m:c,template:h,config:i,imgLink:v,inst:bt(v)},k=sb_st(function(){sj_ue(f,u,g);ni();et(i.ctnShownFlare);r(y,o,"ContainerShown")},i.crd||0),i.crd>0&&sj_be(f,u,g),b=d(500,"h"),p=d(2e3,"d2"),w=d(5e3,"d5"))}function st(){if(i&&t){var u=[o,"ContainerClosed"],n=t.kapiData;n&&(u.push("HasKapiData",n.res?"1":"0"),u.push("Status",n.s+""),n.lt&&u.push("Latency",n.lt+""),n.res&&u.push("Modules","RS|"));r.apply(void 0,__spreadArray([y],u,!1))}l()}function g(){l()}function ht(){t&&t.config&&et(t.config.ctnClkFlr)}function l(){t&&t.el&&sj_ue(t.el,u,g);i&&(sj_ue(i,u,st),sj_ue(i,it,ht),_d.body.removeChild(i));sb_ct(k);sb_ct(b);sb_ct(p);sb_ct(w);k=p=w=b=null;i=t=null}function dt(n,t){var r,u,f,e,i;if(!n)return null;if(r=_qs(t.mainImgSel,n),u=r.closest("a[m]"),r&&u){f=u.getAttribute("m");e=r.getAttribute("src");try{return i=JSON.parse(f),{thurl:e,title:i.t,domain:i.dm,imgUrl:i.url,domainUrl:i.purl,istk:i.istk,domainFid:i.favid}}catch(o){ft("NoMetadata")}}return null}function gt(n){if(t&&i&&n.url===t.m.thurl){t.kapiData=n;sj_appHTML(i,n.res);var r=_qs(".isp_nac",i);r&&(n.fc?r.classList.remove("isp_nac"):ct(r,"isp_anim",!0))}}function ni(){var n,r,k,o,a,e,l,v,d,g,y,nt,c,tt,p,w,rt;if(t&&t.el&&t.template&&(n=t.m,n&&n.thurl)&&(r=t.el.getBoundingClientRect(),i=t.template.cloneNode(!0),i)){var b=_w.scrollX,ft=_w.scrollY,et=b+r.left-ut,ot=b+_d.body.clientWidth-r.width,lt=Math.min(Math.max(et,b),ot),at=ft+r.top-ut;i.style.left=lt+f;i.style.top=at+f;i.style.maxWidth=r.width+f;n.thurl&&(k=_qs(".isp_imgcont",i),o=sj_ce("img"),o.setAttribute("src",n.thurl),o.setAttribute("width",r.width+f),o.setAttribute("height",r.height+f),o.role="presentation",o.onclick=function(){h("ImageClick")},t.imgLink?(a=t.imgLink.cloneNode(),a.removeAttribute("data-idpignore"),a.appendChild(o),k.appendChild(a)):k.appendChild(o));e=_qs(".isp_content",i);l=_qs(".isp_clk_cntr",e);e&&(v=_qs(".isp_title",e),v&&l&&(v.textContent=n.title,d=v.closest("a"),d&&(d.href=n.imgUrl||"#"),g=l.closest("a"),g&&(g.href=n.imgUrl||"#"),l.onclick=function(){h("ContainerClick")}),y=_qs(".isp_domain",e),y&&n.domain&&(y.textContent=n.domain,nt=y.closest("a"),nt&&(nt.href=n.domainUrl||"#"),c=_qs(".isp_domfav",e),c&&n.domainFid?(tt=c.dataset.src,tt&&(c.src=tt.replace("%FAVID%",encodeURIComponent(n.domainFid)))):c&&(c.style.display="none")),p=_qs(".act_enlarge, .act_exp",e),p&&(p.href=n===null||n===void 0?void 0:n.imgUrl,p.onclick=function(n){sj_sp(n);h("EnlargeAction")}),w=_qs(".act_vs",e),w&&(w.href=(n===null||n===void 0?void 0:n.imgUrl)+"&vt=3",w.onclick=function(n){sj_sp(n);h("VisualSearchAction")}));sj_be(i,u,st);sj_be(i,it,ht);i.setAttribute("id",i.dataset.hcid);i.removeAttribute("data-hcid");i.classList.remove("isp_hide");_d.body.appendChild(i);ct(i,"isp_fade",!1);rt=e.offsetHeight;l.style.height="".concat(rt,"px");s&&s.getKapiData({w:r.width,h:r.height,url:n.thurl,istk:n.istk,src:n.istk?"BingImageIndex":"Url"},gt)}}function ti(){sj_evt.fire("SmartPreview.init");sj_evt.bind(rt,c);sj_be(_w,tt,c)}function ct(n,t,i){n&&t&&requestAnimationFrame(function(){return requestAnimationFrame(function(){n.classList.toggle(t,i)})})}var nt="mouseenter",u="mouseleave",tt="unload",it="click",rt="ajax.unload",a="mmisp",f="px",ut=8,v="SmartPreview",lt="Click",at="Hover",y="Info",vt="EventType",o="Text",yt=/^ID=([^,]+),([0-9\.]+)$/,pt="data-nohov",e={},t,i,p,w,b,k,wt=!1,s;n.log=r;n.logError=ft;n.registerConfig=kt;ti()})(SmartPreview||(SmartPreview={}))